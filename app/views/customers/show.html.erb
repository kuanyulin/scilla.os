<table class="showDetail">
  <tr>
    <th>姓名</th><td><%=h @customer.name %></td>
		<th>email</th><td><%= @customer.email %></td>  	
  </tr>
  <tr>
    <th>生日</th><td width="200"><%=h @customer.birthdate %></td>
		<th>會員</th><td><%= show_member_icon(@customer.membership) %> <%=h Customer::MEMBER_STATUS.rassoc(@customer.membership)[0] %>
		(<%= show_currency(@customer.total_purchase) %>)</td>
  </tr>
  <tr>
    <th>手機</th><td><%=h @customer.mobile %></td>
		<th>電話</th><td><%=h @customer.phone %></td>
  </tr>
  <tr>
    <th>地址</th><td colspan="3"><%=h @customer.address %></td>
  </tr>
  <tr>
    <th>匯款銀行</th><td><%=h @customer.bank %></td>
		<th>帳號</th><td></td><%=h @customer.bank_account %></td>
  </tr>
  <tr>
    <th>備註</th><td colspan="3"><%=h @customer.note %></td>
  </tr>
</table>
<br/>

<table cellspacing=0 cellpadding=0 width="700">
  <tr>
		<td width="200" align="left"><%= link_to '＋新增訂單', :controller => 'orders', :action => 'new', :customer_id => @customer.id %></td>
		<td width="200" align="center"><%= link_to '修改顧客資料', edit_customer_path(@customer) %></td>
    <td width="150" align="center"><%= link_to '{顧客總覽}', customers_path %></td>
    <td width="150" align="right"><%= link_to '{訂單總覽}', orders_path %></td>
  </tr>	
</table>


<br/>
<h1><%=h @customer.name %>的所有訂單</h1>
<table class="tableList" cellspacing="0" cellpadding="0" border="0" width="880">
  <tr>
    <th width="40"> </th>
    <th width="80">狀態</th>
    <th width="80">訂單日期</th>
    <th width="100">收件人</th>
    <th width="100">電話</th>
<!--    <th width="200">收件地址</th> -->
    <th width="50">運費</th>
		<th width="80">總價</th>
    <th width="60">配送</th>
    <!--<th>Shipping charge</th>
    <th>Total amount</th>
    <th>Payment type</th>
    <th>Paid date</th> -->
    <th width="70">購買處</th>
<!--    <th>Order number</th>
    <th>Note</th> -->
    <th width="140"> </th>
  </tr>

<% @customer.orders.each do |order| %>
<% shading = cycle('even', 'odd') %>
  <tr class="<%= shading %>">
    <td><%= link_to '出貨', :controller => 'orders', :action => 'packing', :id => order.id %></td>
    <td><%= show_order_status(order.status) %></td>
    <td><small><%=h order.order_date %></small></td>
    <td><%=h order.recipient %></td>
    <td><small><%=h order.phone %></small></td>
		<td><%= show_currency(order.shipping_charge, false) %></td>
		<td><b><%= show_currency(order.total_amount) %></b></td>
<!--    <td><%=h order.shipping_address %></td> -->
    <td><small><%=h Order::SHIPPING_METHOD.rassoc(order.shipping_method)[0] if order.shipping_method %></small></td>
 <!--   <td><%=h order.shipping_charge %></td>
    <td><%=h order.total_amount %></td>
    <td><%=h order.payment_type %></td>
    <td><%=h order.paid_date %></td> -->
    <td><%=h Order::ORDER_LOCATION.rassoc(order.order_from)[0] %></td>
 <!--   <td><%=h order.order_number %></td>
    <td><%=h order.note %></td> -->
    <td><%= link_to '細節', edit_order_path(order) -%>
    <% if session[:user].is_manager %>
		 | <%= link_to '刪除', order, :confirm => 'Are you sure?', :method => :delete -%>
		<% end %></td>
  </tr>
	<% order.items.each do |item| %>
	<%   
      itemstatus = "" 
      if [Order::PAY_ATM, Order::PAY_IBON, Order::PAY_IN_STORE, Order::PAY_DIRECT_ATM].include?(order.payment_type) and order.paid_date.nil?
        itemstatus = image_tag('money_32.png', :alt => "未付款", :border => 0, :width => "24" )
      elsif item.status == Item::ITEM_PENDING and !item.pair.nil? and item.pair.status == Pair::SOLD
        itemstatus = image_tag('truck_32.png', :alt => "趕快出貨囉！", :border => 0, :width => "24" )
      elsif !item.pair.nil? and item.pair.status == Pair::IN_TRANSIT
        itemstatus = image_tag('redcar_32.png', :alt => "等退回", :border => 0, :width => "24")
      end
  %>
	<tr class="<%= shading %>">
		<td><%= itemstatus %></td>
		<td><%= Item::ITEM_STATUS.rassoc(item.status)[0] %></td>
		<td><small><%= item.shipped_date %></small></td>
		<td colspan="3"><b><%= item.style.name %></b> <small>(size: <%= item.size %>)</small> 
		<td colspan="3"><%= show_currency(item.price, false) %> - <%= show_currency(item.discount) %></td>
		
		<td><%= item.pair ? show_pair_status(item.pair.status) + "<small>" + link_to( "("+item.pair_id.to_s+")", :controller => 'pairs', :action => 'show', :id => item.pair_id) + "</small>" : 
                        "<span class='red'>" + link_to('快出貨', edit_item_path(item.id)) + "</span>" %></td>
	</tr>
	<% end %>
<% end %>
</table>